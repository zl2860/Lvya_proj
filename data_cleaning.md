data\_cleaning
================
Zongchao
4/26/2021

# Import data & cleaning

``` r
data = read_excel('./data/家长问卷_刘宗超.xlsx') %>%
    .[-1,]  %>% 
  select(8,9,12:127)
length(unique(data$ID))
```

    ## [1] 316

``` r
# 检查数据
## 出生年处理策略：集中处理-2 -> 取前4个字符 -> 然后处理 "199元"，“4月10日”，“不知道”，"57"
data[data == -2] = NA
unique(data$p4)
```

    ##  [1] "1986"          NA              "1978"          "1989"         
    ##  [5] "1951"          "1990"          "1969"          "1962"         
    ##  [9] "1959"          "1956"          "1980年"        "1980"         
    ## [13] "1949"          "1982"          "1964"          "1993"         
    ## [17] "1979"          "1985"          "1977"          "1965"         
    ## [21] "1966"          "2000"          "1974"          "1970"         
    ## [25] "1976"          "1963"          "1958"          "1988"         
    ## [29] "1987"          "1983"          "2011"          "1971"         
    ## [33] "1986年"        "2020"          "1995"          "1995年"       
    ## [37] "1983年"        "1968"          "1968年"        "1981"         
    ## [41] "1992年"        "1992"          "1954"          "1961"         
    ## [45] "1955"          "1991"          "2012"          "2009"         
    ## [49] "2007"          "2010"          "不知道"        "2008"         
    ## [53] "1975"          "19910"         "1984"          "1936"         
    ## [57] "'200906174677" "4月10日"       "1973"          "1967"         
    ## [61] "1956.3.22"     "1997"          "1952"          "1988.1"       
    ## [65] "1995年6月7日"  "1990.9.1"      "1943"          "199元"        
    ## [69] "1985.11.30"    "1978年2月1日"  "1987.10.26"    "57"           
    ## [73] "1988.3.16"     "1950"          "1972"          "1960"

``` r
## p37处理策略：无需处理
unique(data$p37)
```

    ## [1] "1" "2" NA

``` r
# 处理异常值 -  此处需要根据自己情况DIY！
data = data %>%
  mutate(p4 = ifelse(is.na(p4), "NA", p4)) %>%
  mutate(p4 = case_when(p4 %in% c("199元","4月10日","不知道","57") == FALSE ~ p4,
                        p4 == "199元" ~ "1992",
                        p4 == "不知道" ~ "NA",
                        p4 == "57" ~ "??57",
                        p4 == "4月10日" ~ "NA")) %>%
  mutate(p4 = str_sub(p4, 1, 4),
         p4 = ifelse(p4 == "NA", NA, p4))

# 开始删行
imp_data = data %>%
  select(-missing) %>%
  group_by(ID) %>%
  fill(everything(), .direction = "down") %>%
  fill(everything(), .direction = "up") %>%
  slice(1)
```

# 检查结果

## 检查值

``` r
# 检查日期值 集合
unique(imp_data$p4)
```

    ##  [1] "1961" "1987" "1967" "1982" "1991" "1963" NA     "1983" "1964" "1989"
    ## [11] "1980" "1960" "1985" "2010" "1979" "1988" "1990" "1993" "1972" "1962"
    ## [21] "1974" "1981" "1992" "1950" "1986" "1958" "??57" "1976" "1966" "1973"
    ## [31] "1978" "1975" "1954" "1984" "1943" "1995" "1952" "1997" "1956" "1969"
    ## [41] "2008" "'200" "1936" "1970" "1971" "1977" "1965" "2007" "2009" "2012"
    ## [51] "1955" "1951" "1968" "2011" "2020" "1959" "2000" "1949"

``` r
# 检查房间数 集合
unique(imp_data$p37)
```

    ## [1] "2" "1" NA

## 检查是否填补

``` r
missing_imp = cbind(imp_data$ID, rowSums(is.na(imp_data))) %>% as.data.frame() %>%
  rename("ID" = "V1", "missing_imp" = V2)
missing_original = data %>%
  group_by(ID) %>%
  summarise(missing_min = min(missing)) %>%
  arrange(ID)
```

    ## `summarise()` ungrouping output (override with `.groups` argument)

``` r
# 在check res表格中，若 expected 为 TRUE 代表填补无问题，若为FALSE则根据ID，回到excel表格检查具体数据情况
check_res = left_join(missing_imp, missing_original) %>%
  mutate(missing_imp = as.numeric(as.character(missing_imp)),
         missing_min = as.numeric(as.character(missing_min))) %>%
  mutate(expected = ifelse(missing_imp <= missing_min, TRUE, FALSE))
```

    ## Joining, by = "ID"

``` r
knitr::kable(check_res)
```

| ID       | missing\_imp | missing\_min | expected |
| :------- | -----------: | -----------: | :------- |
| 12242739 |            1 |            2 | TRUE     |
| 12243226 |            5 |            5 | TRUE     |
| 12243440 |            0 |            0 | TRUE     |
| 12243824 |            5 |            5 | TRUE     |
| 12244115 |            0 |            0 | TRUE     |
| 12244547 |            0 |            0 | TRUE     |
| 12245218 |            2 |            2 | TRUE     |
| 12245635 |            7 |            7 | TRUE     |
| 12245920 |            0 |            0 | TRUE     |
| 12246112 |            3 |            3 | TRUE     |
| 12246130 |            7 |            7 | TRUE     |
| 12246714 |            3 |            3 | TRUE     |
| 12246842 |            0 |            0 | TRUE     |
| 12247134 |            1 |            1 | TRUE     |
| 12247717 |            6 |            6 | TRUE     |
| 12247729 |            6 |            6 | TRUE     |
| 12247732 |            6 |            6 | TRUE     |
| 12248145 |            0 |            1 | TRUE     |
| 12248549 |            0 |            6 | TRUE     |
| 12248848 |            2 |            2 | TRUE     |
| 12249211 |            4 |            4 | TRUE     |
| 12249628 |            2 |            2 | TRUE     |
| 12249840 |            2 |            2 | TRUE     |
| 12251244 |            0 |            0 | TRUE     |
| 12251326 |            0 |            0 | TRUE     |
| 12251912 |            0 |            0 | TRUE     |
| 12252718 |            2 |            2 | TRUE     |
| 12252720 |            0 |            0 | TRUE     |
| 12252840 |            1 |            1 | TRUE     |
| 12253133 |            0 |            0 | TRUE     |
| 12253139 |           37 |           37 | TRUE     |
| 12253714 |           18 |           18 | TRUE     |
| 12254613 |            4 |            5 | TRUE     |
| 12255942 |            0 |            0 | TRUE     |
| 12256128 |            0 |            0 | TRUE     |
| 12256217 |            4 |            4 | TRUE     |
| 12256422 |            6 |            6 | TRUE     |
| 12256731 |            0 |            0 | TRUE     |
| 12256738 |            0 |            0 | TRUE     |
| 12256947 |            0 |            0 | TRUE     |
| 12257429 |            2 |            2 | TRUE     |
| 12257846 |            1 |            1 | TRUE     |
| 12258145 |            0 |            0 | TRUE     |
| 12258711 |            2 |            2 | TRUE     |
| 12258727 |            4 |            4 | TRUE     |
| 12259434 |            1 |            1 | TRUE     |
| 12262518 |            0 |            0 | TRUE     |
| 12263615 |            3 |            3 | TRUE     |
| 12263920 |            3 |            3 | TRUE     |
| 12264132 |            7 |            7 | TRUE     |
| 12264324 |            0 |            0 | TRUE     |
| 12264713 |            0 |            0 | TRUE     |
| 12265216 |            6 |            6 | TRUE     |
| 12265321 |            0 |            0 | TRUE     |
| 12265334 |            1 |            1 | TRUE     |
| 12265528 |            5 |            5 | TRUE     |
| 12265544 |            4 |            4 | TRUE     |
| 12265931 |            0 |            0 | TRUE     |
| 12266145 |            1 |            1 | TRUE     |
| 12266246 |            0 |            0 | TRUE     |
| 12266722 |            2 |            2 | TRUE     |
| 12266727 |            1 |            1 | TRUE     |
| 12266929 |            1 |            1 | TRUE     |
| 12267233 |            0 |            0 | TRUE     |
| 12267923 |           12 |           12 | TRUE     |
| 12268414 |           46 |           46 | TRUE     |
| 12268512 |            8 |            9 | TRUE     |
| 12269647 |           17 |           17 | TRUE     |
| 12271543 |            2 |            2 | TRUE     |
| 12272225 |            1 |            1 | TRUE     |
| 12272316 |            2 |            2 | TRUE     |
| 12272551 |            0 |            0 | TRUE     |
| 12272638 |            0 |            0 | TRUE     |
| 12272745 |            1 |            1 | TRUE     |
| 12273328 |            0 |            0 | TRUE     |
| 12273754 |            2 |            2 | TRUE     |
| 12273831 |            0 |            0 | TRUE     |
| 12274144 |            6 |            6 | TRUE     |
| 12274714 |            3 |            3 | TRUE     |
| 12275320 |            1 |            1 | TRUE     |
| 12275750 |            0 |            0 | TRUE     |
| 12275915 |            0 |            0 | TRUE     |
| 12276122 |            2 |            2 | TRUE     |
| 12276248 |            1 |            1 | TRUE     |
| 12277240 |            2 |            2 | TRUE     |
| 12277427 |            0 |            0 | TRUE     |
| 12277617 |            1 |            1 | TRUE     |
| 12278355 |            0 |            0 | TRUE     |
| 12278523 |            1 |            1 | TRUE     |
| 12278547 |            1 |            1 | TRUE     |
| 12279549 |            0 |            0 | TRUE     |
| 12281336 |            0 |            0 | TRUE     |
| 12281527 |            0 |            0 | TRUE     |
| 12281845 |            4 |            4 | TRUE     |
| 12281946 |            6 |            6 | TRUE     |
| 12282623 |            0 |            0 | TRUE     |
| 12282648 |            1 |            1 | TRUE     |
| 12282928 |            1 |            2 | TRUE     |
| 12283331 |            0 |            0 | TRUE     |
| 12283341 |            5 |            5 | TRUE     |
| 12283716 |           10 |           10 | TRUE     |
| 12284735 |            2 |            2 | TRUE     |
| 12285419 |            0 |            0 | TRUE     |
| 12286249 |            2 |            2 | TRUE     |
| 12286733 |            0 |            0 | TRUE     |
| 12287220 |            0 |            0 | TRUE     |
| 12288418 |            3 |            3 | TRUE     |
| 12288515 |            3 |            3 | TRUE     |
| 12288639 |            3 |            4 | TRUE     |
| 12288713 |            1 |            1 | TRUE     |
| 12288942 |            0 |            0 | TRUE     |
| 12289534 |            1 |            1 | TRUE     |
| 12289614 |            5 |            5 | TRUE     |
| 12291528 |            2 |            2 | TRUE     |
| 12291643 |            0 |            0 | TRUE     |
| 12291917 |            0 |            0 | TRUE     |
| 12292115 |            0 |            0 | TRUE     |
| 12292146 |            0 |            0 | TRUE     |
| 12292548 |            1 |            1 | TRUE     |
| 12292924 |            2 |            2 | TRUE     |
| 12293518 |            9 |           11 | TRUE     |
| 12294238 |            5 |            6 | TRUE     |
| 12294619 |            1 |            1 | TRUE     |
| 12294826 |            0 |            0 | TRUE     |
| 12294833 |            0 |            0 | TRUE     |
| 12295729 |           21 |           21 | TRUE     |
| 12295825 |            3 |            3 | TRUE     |
| 12296130 |            8 |            8 | TRUE     |
| 12296235 |            0 |            0 | TRUE     |
| 12296322 |            0 |            0 | TRUE     |
| 12296445 |            2 |            2 | TRUE     |
| 12296612 |            0 |            0 | TRUE     |
| 12296813 |            1 |            1 | TRUE     |
| 12296842 |            1 |            1 | TRUE     |
| 12296911 |            2 |            3 | TRUE     |
| 12297144 |            0 |            0 | TRUE     |
| 12298214 |            4 |           10 | TRUE     |
| 12298234 |            8 |            8 | TRUE     |
| 12298247 |            1 |            1 | TRUE     |
| 12298431 |            0 |            0 | TRUE     |
| 12298732 |            0 |            0 | TRUE     |
| 12298936 |            0 |            0 | TRUE     |
| 12299121 |           18 |           18 | TRUE     |
| 12299327 |            0 |            0 | TRUE     |
| 12299340 |            0 |            0 | TRUE     |
| 12299616 |           10 |           10 | TRUE     |
| 12299639 |            0 |            0 | TRUE     |
| 12299641 |            0 |            1 | TRUE     |
| 13311125 |            1 |            1 | TRUE     |
| 13311822 |            1 |            2 | TRUE     |
| 13311827 |           43 |           43 | TRUE     |
| 13312217 |            0 |            0 | TRUE     |
| 13312230 |            3 |            3 | TRUE     |
| 13312524 |           44 |           44 | TRUE     |
| 13312538 |           43 |           44 | TRUE     |
| 13312642 |            1 |            2 | TRUE     |
| 13312911 |            3 |            3 | TRUE     |
| 13313326 |            1 |            1 | TRUE     |
| 13313532 |            2 |            2 | TRUE     |
| 13313634 |            6 |            6 | TRUE     |
| 13313640 |            3 |            3 | TRUE     |
| 13314721 |            3 |            3 | TRUE     |
| 13314912 |            0 |            0 | TRUE     |
| 13315115 |            2 |            2 | TRUE     |
| 13315720 |            0 |            0 | TRUE     |
| 13316435 |            2 |            2 | TRUE     |
| 13316941 |            2 |            3 | TRUE     |
| 13317419 |            7 |            8 | TRUE     |
| 13317523 |            0 |            0 | TRUE     |
| 13317933 |            0 |            0 | TRUE     |
| 13318431 |           45 |           45 | TRUE     |
| 13318616 |           13 |           13 | TRUE     |
| 13321519 |            2 |            2 | TRUE     |
| 13322823 |            0 |            0 | TRUE     |
| 13322917 |            1 |            1 | TRUE     |
| 13322920 |            3 |            3 | TRUE     |
| 13323122 |            3 |            3 | TRUE     |
| 13323528 |            5 |            6 | TRUE     |
| 13324714 |            1 |            0 | FALSE    |
| 13324731 |            0 |            0 | TRUE     |
| 13324735 |            2 |            2 | TRUE     |
| 13324930 |           10 |           10 | TRUE     |
| 13325333 |            4 |            5 | TRUE     |
| 13325436 |            2 |            2 | TRUE     |
| 13325437 |            6 |            6 | TRUE     |
| 13325440 |            6 |            6 | TRUE     |
| 13325711 |            0 |            0 | TRUE     |
| 13326141 |            1 |            1 | TRUE     |
| 13326618 |            0 |            0 | TRUE     |
| 13327734 |            1 |            1 | TRUE     |
| 13328226 |            0 |            0 | TRUE     |
| 13328715 |            0 |            0 | TRUE     |
| 13328927 |            5 |            5 | TRUE     |
| 13331822 |            0 |            0 | TRUE     |
| 13332311 |            1 |            1 | TRUE     |
| 13332314 |            0 |            0 | TRUE     |
| 13332363 |            3 |            3 | TRUE     |
| 13332618 |            2 |            2 | TRUE     |
| 13332734 |            0 |            0 | TRUE     |
| 13332735 |            0 |            0 | TRUE     |
| 13333621 |            2 |            2 | TRUE     |
| 13333937 |            2 |            2 | TRUE     |
| 13334536 |            0 |            0 | TRUE     |
| 13334833 |            0 |            0 | TRUE     |
| 13335413 |            0 |            0 | TRUE     |
| 13335539 |            5 |            5 | TRUE     |
| 13335928 |            4 |            4 | TRUE     |
| 13335930 |            8 |            8 | TRUE     |
| 13336916 |            0 |            0 | TRUE     |
| 13337527 |            0 |            0 | TRUE     |
| 13337815 |            1 |            1 | TRUE     |
| 13337912 |            0 |            0 | TRUE     |
| 13337942 |            0 |            0 | TRUE     |
| 13339320 |            2 |            2 | TRUE     |
| 13339529 |            0 |            0 | TRUE     |
| 13339538 |            1 |            1 | TRUE     |
| 13339626 |            0 |            0 | TRUE     |
| 14411111 |            0 |            0 | TRUE     |
| 14411617 |           14 |           16 | TRUE     |
| 14411749 |            0 |            0 | TRUE     |
| 14411945 |            3 |            3 | TRUE     |
| 14412212 |            1 |            1 | TRUE     |
| 14412947 |            0 |            0 | TRUE     |
| 14413343 |            4 |            4 | TRUE     |
| 14414121 |            2 |            2 | TRUE     |
| 14414240 |            1 |            1 | TRUE     |
| 14414816 |            1 |            1 | TRUE     |
| 14414831 |            3 |            4 | TRUE     |
| 14415844 |            0 |            0 | TRUE     |
| 14416314 |            0 |            0 | TRUE     |
| 14416436 |            1 |            1 | TRUE     |
| 14416522 |           45 |           45 | TRUE     |
| 14416823 |            1 |            1 | TRUE     |
| 14417218 |            2 |            3 | TRUE     |
| 14417752 |            0 |            0 | TRUE     |
| 14418313 |            0 |            0 | TRUE     |
| 14418641 |            1 |            1 | TRUE     |
| 14418837 |            1 |            2 | TRUE     |
| 14419126 |            0 |            0 | TRUE     |
| 14421236 |            1 |            3 | TRUE     |
| 14421411 |            0 |            0 | TRUE     |
| 14421416 |           17 |           18 | TRUE     |
| 14421629 |            5 |            5 | TRUE     |
| 14421924 |            0 |            0 | TRUE     |
| 14422130 |            0 |            0 | TRUE     |
| 14422639 |            0 |            0 | TRUE     |
| 14423537 |            2 |            2 | TRUE     |
| 14423615 |            0 |            0 | TRUE     |
| 14423844 |            0 |            0 | TRUE     |
| 14426320 |            2 |            2 | TRUE     |
| 14426431 |            1 |            1 | TRUE     |
| 14426527 |            0 |            0 | TRUE     |
| 14426532 |            1 |            1 | TRUE     |
| 14426535 |            1 |            1 | TRUE     |
| 14426645 |            0 |            0 | TRUE     |
| 14427623 |            0 |            0 | TRUE     |
| 14427722 |            0 |            1 | TRUE     |
| 14427826 |           10 |           11 | TRUE     |
| 14427833 |            1 |            1 | TRUE     |
| 14427842 |            5 |            5 | TRUE     |
| 14427914 |            1 |            1 | TRUE     |
| 14428940 |            0 |            8 | TRUE     |
| 14431411 |            1 |            2 | TRUE     |
| 14431730 |            6 |            6 | TRUE     |
| 14431740 |            8 |            8 | TRUE     |
| 14432319 |            7 |            9 | TRUE     |
| 14432347 |            0 |            0 | TRUE     |
| 14432533 |           47 |           47 | TRUE     |
| 14432631 |            2 |            2 | TRUE     |
| 14432712 |            2 |            2 | TRUE     |
| 14432948 |            1 |            1 | TRUE     |
| 14433327 |            1 |            1 | TRUE     |
| 14433356 |            3 |            3 | TRUE     |
| 14433421 |            2 |            2 | TRUE     |
| 14433625 |           11 |           11 | TRUE     |
| 14433729 |            9 |           14 | TRUE     |
| 14433843 |            3 |            3 | TRUE     |
| 14434150 |            0 |            0 | TRUE     |
| 14434252 |            4 |            4 | TRUE     |
| 14434657 |            2 |            3 | TRUE     |
| 14435138 |            0 |            0 | TRUE     |
| 14435839 |            7 |            7 | TRUE     |
| 14435893 |            7 |            7 | TRUE     |
| 14436132 |            3 |            4 | TRUE     |
| 14437145 |            7 |            7 | TRUE     |
| 14437258 |            0 |            0 | TRUE     |
| 14437414 |            5 |            5 | TRUE     |
| 14437417 |            8 |            8 | TRUE     |
| 14437444 |            1 |            1 | TRUE     |
| 14438154 |            0 |            0 | TRUE     |
| 14438220 |           42 |           42 | TRUE     |
| 14438353 |            0 |            0 | TRUE     |
| 14438659 |            5 |            5 | TRUE     |
| 14438728 |            6 |            6 | TRUE     |
| 14439213 |            2 |            2 | TRUE     |
| 14439236 |           10 |           10 | TRUE     |
| 14439326 |            1 |            1 | TRUE     |
| 14439341 |            0 |            1 | TRUE     |
| 14439415 |            2 |            2 | TRUE     |
| 14439537 |           40 |           40 | TRUE     |
| 14439642 |            0 |            1 | TRUE     |
| 14441336 |            6 |            6 | TRUE     |
| 14441519 |            0 |            0 | TRUE     |
| 14442237 |            1 |            1 | TRUE     |
| 14442517 |            2 |            2 | TRUE     |
| 14442616 |            9 |            9 | TRUE     |
| 14443611 |           13 |           14 | TRUE     |
| 14443720 |            3 |            3 | TRUE     |
| 14444224 |            0 |            0 | TRUE     |
| 14444233 |            8 |            8 | TRUE     |
| 14444244 |            0 |            0 | TRUE     |
| 14444429 |            0 |            0 | TRUE     |
| 14445343 |            2 |            2 | TRUE     |
| 14445527 |            5 |            5 | TRUE     |
| 14445532 |            1 |            1 | TRUE     |
| 14445834 |            0 |            0 | TRUE     |

# 导出

仅一条数据填补结果不符合要求（ID: 13324714），核查后发现是由于回答问卷的人操作不当所致，没有问题。

``` r
write.csv(imp_data, './问卷-已清理_刘宗超.csv',row.names = F)
```
